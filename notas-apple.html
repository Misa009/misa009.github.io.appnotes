<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>Notas</title>
  <style>
    :root{
      --bg:#000;
      --panel:#0c0c0e;
      --panel2:#111114;
      --panel3:#1a1a1e;
      --txt:#f5f5f7;
      --muted:#9a9aa0;
      --line:#232327;
      --yellow:#ffd60a;
      --danger:#ff453a;
      --radius:16px;
    }
    *{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial}
    body{margin:0;background:var(--bg);color:var(--txt)}
    button{font:inherit}
    .app{max-width:480px;margin:0 auto;min-height:100vh;background:var(--bg)}
    header{
      position:sticky;top:0;z-index:30;
      background:linear-gradient(180deg,#0a0a0b,rgba(0,0,0,0.95));
      padding:10px 12px 8px;border-bottom:1px solid #0b0b0c;
      display:flex;align-items:center;gap:8px;
    }
    .title{
      font-size:24px;font-weight:800;letter-spacing:.2px;flex:1;
    }
    .icon-btn{
      width:36px;height:36px;border-radius:10px;
      background:var(--panel2);border:1px solid var(--line);color:var(--txt);
      display:grid;place-items:center;cursor:pointer;
    }
    .icon-btn.yellow{color:#000;background:var(--yellow);border-color:var(--yellow);font-weight:900}

    .searchbar{
      margin:10px 12px 8px;background:var(--panel2);
      border:1px solid var(--line);border-radius:12px;
      display:flex;align-items:center;gap:8px;padding:8px 10px;color:var(--muted)
    }
    .searchbar input{
      background:transparent;border:0;outline:0;color:var(--txt);flex:1;font-size:15px;
    }

    .list{padding:6px 8px 96px}
    .note-card{
      background:var(--panel);border:1px solid var(--line);
      border-radius:14px;padding:12px 12px;display:flex;gap:10px;align-items:flex-start;
      margin:8px 4px;cursor:pointer;transition:transform .06s ease, background .12s ease;
    }
    .note-card:active{transform:scale(.985);background:var(--panel2)}
    .note-meta{flex:1;min-width:0}
    .note-title{
      font-weight:700;font-size:16px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
    }
    .note-snippet{
      color:var(--muted);font-size:14px;margin-top:4px;line-height:1.3;
      display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;
    }
    .note-date{color:var(--muted);font-size:12px;margin-top:6px}
    .delete-btn{
      background:transparent;border:0;color:var(--muted);font-size:18px;cursor:pointer;padding:2px 4px;
    }
    .delete-btn:hover{color:var(--danger)}

    /* Editor modal */
    .overlay{
      position:fixed;inset:0;background:rgba(0,0,0,.55);
      z-index:50;display:none;align-items:flex-end;justify-content:center;
      backdrop-filter: blur(4px);
    }
    .overlay.show{display:flex}
    .sheet{
      width:100%;max-width:480px;background:var(--panel2);
      border-top-left-radius:20px;border-top-right-radius:20px;
      border:1px solid var(--line);border-bottom:0;
      padding:10px 10px 14px;
      box-shadow:0 -10px 40px rgba(0,0,0,.6);
      max-height:92vh;display:flex;flex-direction:column;gap:8px;
    }
    .sheet-header{
      display:flex;align-items:center;gap:8px;padding:4px 4px 0;
    }
    .sheet-header .back{
      border:0;background:transparent;color:var(--yellow);font-weight:700;font-size:16px;cursor:pointer;
    }
    .sheet-header .actions{margin-left:auto;display:flex;gap:8px}
    .sheet-header .ghost{
      border:1px solid var(--line);background:var(--panel3);color:var(--txt);
      border-radius:10px;padding:6px 10px;font-weight:600;cursor:pointer;
    }
    .sheet-header .ghost.danger{color:#fff;border-color:#3a1b1b;background:#2a1212}
    .sheet-header .ghost.yellow{background:var(--yellow);border-color:var(--yellow);color:#000}

    .editor{
      background:var(--panel);border:1px solid var(--line);border-radius:14px;
      padding:10px;display:flex;flex-direction:column;gap:8px;flex:1;min-height:50vh;
    }
    .editor input{
      width:100%;background:transparent;border:0;outline:0;color:var(--txt);
      font-size:20px;font-weight:800;letter-spacing:.2px;
    }
    .editor textarea{
      flex:1;width:100%;background:transparent;border:0;outline:0;color:var(--txt);
      font-size:16px;line-height:1.5;resize:none;
    }
    .empty{
      color:var(--muted);text-align:center;margin-top:24px;font-size:14px;
    }

    /* Bottom bar like iOS */
    .bottom{
      position:fixed;left:0;right:0;bottom:0;z-index:25;
      background:linear-gradient(180deg,rgba(0,0,0,0),#000 40%);
      padding:10px 12px 18px;display:flex;justify-content:center;
    }
    .fab{
      width:56px;height:56px;border-radius:18px;background:var(--yellow);
      color:#000;font-size:30px;font-weight:900;border:0;cursor:pointer;
      display:grid;place-items:center;box-shadow:0 10px 25px rgba(255,214,10,.25);
    }
  </style>
</head>
<body>
<div class="app">
  <header>
    <div class="title">Notas</div>
    <button class="icon-btn" id="sortBtn" title="Ordenar">‚áÖ</button>
    <button class="icon-btn" id="exportBtn" title="Exportar">‚§¥Ô∏é</button>
  </header>

  <div class="searchbar">
    üîé <input id="search" type="text" placeholder="Buscar"/>
  </div>

  <div class="list" id="list"></div>

  <div class="bottom">
    <button class="fab" id="newBtn" title="Nueva nota">Ôºã</button>
  </div>
</div>

<!-- Editor modal -->
<div class="overlay" id="overlay">
  <div class="sheet">
    <div class="sheet-header">
      <button class="back" id="closeBtn">Notas</button>
      <div class="actions">
        <button class="ghost danger" id="deleteCurrentBtn">Eliminar</button>
        <button class="ghost yellow" id="saveBtn">Guardar</button>
      </div>
    </div>
    <div class="editor">
      <input id="titleInput" placeholder="T√≠tulo"/>
      <textarea id="bodyInput" placeholder="Escribe algo..."></textarea>
    </div>
  </div>
</div>

<script>
  // ===== Storage =====
  const KEY = "apple_notes_clone_v1";
  let notes = [];
  let filtered = [];
  let currentId = null;
  let sortDesc = true;

  const listEl = document.getElementById("list");
  const overlay = document.getElementById("overlay");
  const titleInput = document.getElementById("titleInput");
  const bodyInput = document.getElementById("bodyInput");
  const searchInput = document.getElementById("search");
  const newBtn = document.getElementById("newBtn");
  const closeBtn = document.getElementById("closeBtn");
  const saveBtn = document.getElementById("saveBtn");
  const deleteCurrentBtn = document.getElementById("deleteCurrentBtn");
  const sortBtn = document.getElementById("sortBtn");
  const exportBtn = document.getElementById("exportBtn");

  function load(){
    try{
      notes = JSON.parse(localStorage.getItem(KEY) || "[]");
    }catch(e){ notes = []; }
    render();
  }
  function persist(){
    localStorage.setItem(KEY, JSON.stringify(notes));
  }

  function uid(){
    return "n_" + Math.random().toString(36).slice(2) + Date.now().toString(36);
  }

  function nowStr(ts){
    const d = new Date(ts);
    return d.toLocaleString("es-ES", { day:"2-digit", month:"short", year:"numeric", hour:"2-digit", minute:"2-digit" });
  }

  // ===== CRUD =====
  function createNote(){
    currentId = null;
    titleInput.value = "";
    bodyInput.value = "";
    openEditor();
    setTimeout(()=>titleInput.focus(), 50);
  }

  function openNote(id){
    const n = notes.find(x=>x.id===id);
    if(!n) return;
    currentId = id;
    titleInput.value = n.title || "";
    bodyInput.value = n.body || "";
    openEditor();
    setTimeout(()=>bodyInput.focus(), 50);
  }

  function saveNote(){
    const title = titleInput.value.trim();
    const body = bodyInput.value.trim();
    const ts = Date.now();

    if(currentId){
      const n = notes.find(x=>x.id===currentId);
      if(!n) return;
      n.title = title;
      n.body = body;
      n.updatedAt = ts;
    }else{
      notes.unshift({ id:uid(), title, body, createdAt:ts, updatedAt:ts });
    }
    persist();
    closeEditor();
    render();
  }

  function deleteNote(id){
    notes = notes.filter(n=>n.id!==id);
    persist();
    render();
  }

  function deleteCurrent(){
    if(!currentId){ closeEditor(); return; }
    deleteNote(currentId);
    closeEditor();
  }

  // ===== UI render =====
  function getDisplayList(){
    const term = searchInput.value.trim().toLowerCase();
    let list = [...notes];

    list.sort((a,b)=> sortDesc ? b.updatedAt - a.updatedAt : a.updatedAt - b.updatedAt);

    if(term){
      list = list.filter(n =>
        (n.title||"").toLowerCase().includes(term) ||
        (n.body||"").toLowerCase().includes(term)
      );
    }
    return list;
  }

  function render(){
    filtered = getDisplayList();
    listEl.innerHTML = "";

    if(filtered.length===0){
      listEl.innerHTML = `<div class="empty">No hay notas todav√≠a</div>`;
      return;
    }

    filtered.forEach(n=>{
      const title = n.title || (n.body||"").split("\n")[0].slice(0,70) || "Sin t√≠tulo";
      const snippet = (n.body||"").replace(/\n+/g," ").trim();
      const card = document.createElement("div");
      card.className = "note-card";
      card.innerHTML = `
        <div class="note-meta">
          <div class="note-title">${escapeHtml(title)}</div>
          <div class="note-snippet">${escapeHtml(snippet)}</div>
          <div class="note-date">${nowStr(n.updatedAt)}</div>
        </div>
        <button class="delete-btn" title="Eliminar">üóëÔ∏è</button>
      `;
      card.addEventListener("click", (e)=>{
        if(e.target.closest(".delete-btn")) return;
        openNote(n.id);
      });
      card.querySelector(".delete-btn").addEventListener("click", (e)=>{
        e.stopPropagation();
        if(confirm("¬øBorrar esta nota?")) deleteNote(n.id);
      });
      listEl.appendChild(card);
    });
  }

  function openEditor(){
    overlay.classList.add("show");
    document.body.style.overflow="hidden";
  }
  function closeEditor(){
    overlay.classList.remove("show");
    document.body.style.overflow="";
  }

  // ===== Export =====
  function exportNotes(){
    const data = JSON.stringify(notes, null, 2);
    const blob = new Blob([data], {type:"application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href=url; a.download="notas.json"; a.click();
    URL.revokeObjectURL(url);
  }

  // Basic HTML escaping
  function escapeHtml(str){
    return (str||"").replace(/[&<>"']/g, s=>({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
    }[s]));
  }

  // ===== Events =====
  newBtn.addEventListener("click", createNote);
  closeBtn.addEventListener("click", closeEditor);
  saveBtn.addEventListener("click", saveNote);
  deleteCurrentBtn.addEventListener("click", ()=>{
    if(confirm("¬øEliminar esta nota?")) deleteCurrent();
  });
  searchInput.addEventListener("input", render);
  sortBtn.addEventListener("click", ()=>{
    sortDesc = !sortDesc;
    sortBtn.textContent = sortDesc ? "‚áÖ" : "‚áµ";
    render();
  });
  exportBtn.addEventListener("click", exportNotes);

  // Save with Cmd/Ctrl+S
  document.addEventListener("keydown", (e)=>{
    if((e.ctrlKey||e.metaKey) && e.key.toLowerCase()==="s"){
      e.preventDefault(); saveNote();
    }
    if(e.key==="Escape" && overlay.classList.contains("show")) closeEditor();
  });

  load();
</script>
</body>
</html>
